# AWS 배포 설명

1. EC2를 선택한 이유

EC2는 공인 IP를 제공하는 리눅스 기반의 클라우드 서버로,
개인 PC와 달리 유동 IP 변경이나 포트포워딩 설정 없이 외부 접근이 가능하며,
서버를 항상 실행 상태로 유지할 수 있어 24시간 안정적인 서비스 운영이 가능합니다.

## 2. 보안 그룹 설정 이유

| 포트 | 용도        | 허용 범위    | 설명                                    |
| ---- | ----------- | ------------ | --------------------------------------- |
| 3000 | Frontend    | 0.0.0.0/0    | 사용자 웹 접속                          |
| 8080 | Backend API | 0.0.0.0/0    | 프론트엔드 및 외부 클라이언트 요청 처리 |
| 22   | SSH         | 특정 IP 권장 | 서버 관리 및 배포                       |

22번 포트의 경우 github action을 사용하기 위해서는 깃허브 액션의 ip를 허용하거나 배포시에만 열어놓아야 할 수 있습니다.

## 3. 서버에서 실행한 명령 흐름

1. git clone {repo 주소} {폴더명}

   - 깃에서 클론을 통해 프로젝트를 내려받습니다.
   - 한번 클론한 후에는 git pull을 통해서 변경사항을 내려받습니다.

2. vim ./backend/.env.prod

   - 민감한 정보의 경우 수동으로 .env.prod에 담습니다. 해당 내용은 컴포즈 파일을 통해 컨테이너내의 환경변수로 주입됩니다.

3. docker-compose -f docker-compose.local.yml up -d
   - 도커 컴포즈를 통해 컨테이너를 생성합니다.
   - -d 옵션으로 백그라운드 실행을 하게 합니다.
   - 이미지의 변경이 있을경우에는 --build 옵션을 통해서 변경할 수 있습니다.

## 4. 배포 후 접속 방식

사용자는 브라우저를 통해 Frontend에 접속하고, Frontend는 Backend API를 호출하며, Backend는 MySQL과 통신하는 구조입니다.

1. 브라우저 → Frontend 접속

   - http://<EC2_PUBLIC_IP>:3000
   - 사용자는 웹 브라우저를 통해 위 주소로 접속하고, EC2 서버의 3000번 포트는 frontend 컨테이너에 매핑되어 있습니다.

2. Frontend → Backend API 호출

   - 서버 컴포넌트일 경우 내부적으로 도커 네트워크내에서 호출을 하게 됩니다.
   - 클라이언트 컴포넌트일 경우 브라우저에서 ec2ip:8080으로 서버 외부에서 호출하게 됩니다.
   - 해당 프로젝트에서는 클라이언트 컴포넌트를 사용했으므로 후자의 경우로 호출합니다.

3. Backend → MySQL DB 컨테이너 접근
   - 컴포즈로 묶은 컨테이너는 같은 도커 네트워크를 공유하므로 jdbc:mysql://mysql:3306/tmidb와 같이 서비스 이름으로 접근할 수 있습니다.
